# 20377199 赵芮箐 第6周作业

![image-20221009110614529](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221009110614529.png)

### 任务一：实现基类Filter

```python
#实现基类
class Filter:
    def __init__(self, path, *plist):
        """
        两个数据属性
        image:待处理的图片实例，即PIL库的Image实例
        plist:参数列表，用以存储可能使用参数的滤波器的参数
        """
        self._image = Image.open(path)
        self._plist = plist
    
    def filter(self):
        """
        能够对Image实例的特定处理，在子类中具体实现
        """
        pass
```

### 任务二：实现Filter 类的多个子类，对filter()方法进行实现

```python
class FIND_EDGES_Filter(Filter):
    '''
    提取边缘
    '''
    def __init__(self, path, *plist):
        super().__init__(path, plist)
    
    def filter(self):
        image_filter = self._image.filter(ImageFilter.FIND_EDGES)
        self._image = image_filter
        return image_filter

class SHARPEN_Filter(Filter):
    '''
    锐化
    '''
    def __init__(self, path, *plist):
        super().__init__(path, plist)
    
    def filter(self):
        image_filter = self._image.filter(ImageFilter.SHARPEN)
        self._image = image_filter
        return image_filter

class BLUR_Filter(Filter):
    '''
    模糊
    '''
    def __init__(self, path, *plist):
        super().__init__(path, plist)
    
    def filter(self):
        image_filter = self._image.filter(ImageFilter.BLUR)
        self._image = image_filter
        return image_filter

class RESIZE_Filter(Filter):
    '''
    大小调整
    '''
    def __init__(self, path, *plist):
        super().__init__(path, plist)
    
    def filter(self):
        w,h = self._image.size
        wrate = self._plist[0]
        hrate = self._plist[1]
        image_filter = self._image.resize((int(w*wrate),int(h*hrate)))
        self._image = image_filter
        return image_filter
```

### 任务三：实现类ImageShop，实现对图片的加载、处理、展示及输出

```python
class ImageShop:
    def __init__(self, formation, filepath):
        """
        三个数据属性
        formation:图片格式
        filepath:图片文件（应该支持目录）
        imglist:存储处理图片的列表
        """
        self._formation = formation
        self._filepath = filepath
        self._imglist = []
        self._imgpro = []

    def load_images(self):
        """
        从路径加载特定格式的图片
        """
        dirs = os.listdir(self._filepath)						# 获取指定路径下的文件
        for path in dirs:
            if os.path.splitext(path)[1] == self._formation:	# 加载目录中所有特定格式图片
                img = Filter(self._filepath + '/' + path)
                self._imglist.append(img)						# 以Fliter类储存

    def __batch_ps(self, Filter, *plist):
        """
        处理图片的内部方法，利用某个过滤器(Filter)对所有图片进行处理
        """
        for i in range(len(self._imglist)):
            img = self._imglist[i]
            img._plist = plist                                  # 更新参数属性
            img_pro = Filter.filter(img)                        # 处理图片
            self._imglist[i] = img

    def batch_ps(self, *args):
        """
        批量处理图片的对外公开方法，可以同时进行若干操作
        args:不定长操作参数，参数按一种特定格式的tuple输入，比如（操作名，参数）
        """
        for op in args:
            if op[0] == 'find_edges':
                self.__batch_ps(FIND_EDGES_Filter)
            elif op[0] == 'sharpen':
                self.__batch_ps(SHARPEN_Filter)
            elif op[0] == 'blur':
                self.__batch_ps(BLUR_Filter)
            elif op[0] == 'resize':
                self.__batch_ps(RESIZE_Filter, op[1:])
            else:
                print("Error, do not find operation named {}.".format(op[0]))
                break
        
    def display(self, row=2, col=2, max_num=100):
        """
        处理效果显示
        row&col:图片呈现可能需要行和列
        sieze:每张图片的大小
        max_num:最多显示多少张
        """
        if len(self._imglist) > max_num:						# 控制最大显示图片数
            self._imglist = self._imglist[:max_num]
        for num in range(0,len(self._imglist), row*col):
            for i in range(row*col):							# 控制每张子图展示图片数量
                if num + i < len(self._imglist):
                    img = self._imglist[num+i]
                    plt.subplot(row, col, i+1)
                    plt.imshow(img._image)
            plt.show()

    def save(self, path, formation = '.png'):
        """
        处理结果输出
        path:输出路径
        formation:输出格式，默认为png
        """
        for i in range(len(self._imglist)):
            img = self._imglist[i]
            img._image.save(path+str(i+1)+formation)
```

### 任务四：实现测试类TestImageShop，实现对ImageShop类的测试

```python
class TestImageShop:
    def __init__(self, formation, filepath):
        self._test = ImageShop(formation, filepath)

    def text_imageshop(self, *args):
        self._test.load_images()
        self._test.batch_ps(args)
        self._test.display()
        self._test.save('week6/photo_fliter/')
```

### 结果展示：

- display( ) 效果展示

  以8张照片为例，参数设置为2x2

  ![image-20221012004625626](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221012004625626.png)

  ![image-20221012004813209](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221012004813209.png)

  > 最后一张照片是我和lpj合照，真的看到结果心碎了

- filter( ) 效果展示

  锐化+提取边缘操作如上面所展示（实测先锐化再提取边缘效果会更好）

  下展示模糊+调整大小操作：

  ![image-20221012005410174](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221012005410174.png)

  ![image-20221012005349207](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221012005349207.png)

### 思考：

（附加）观察一些经过过滤后图片的变化，思考这些处理对图片本身的一些相关的计算，如图片的相似性等有无影响，并进行简单的实验验证。另外，这些预处理本身对下游的机器学习模型会带来哪些好处？



### 代码：



### Ref:

- PIL：https://pillow.readthedocs.io/en/stable/reference/ImageFilter.html
- torchvision.transforms：
- 深度卷积网络：