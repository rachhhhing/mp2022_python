# 20377199 赵芮箐 第14周作业

![image-20221206204207524](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221206204207524.png)

### 总体思路：

真的真的非常划水的一周了...

基本沿用12周的框架，主要是改了主函数，将多线程实现的部分改为了协程实现。

协程的实现依赖于gevent库，yysy gevent库真的清晰简洁好写！

### 爬虫部分：

```python
id_list = []
headers = {  
        'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'  
    }

def producer(url):
    response = requests.get(url=url, headers=headers)  
    html = response.text 
    soup = BeautifulSoup(html, 'html.parser')   
    ids = soup.select('.dec a')                             # 获取包含歌单详情页网址的标签
    id_list.extend(ids)

def consumer(id):
    url = 'https://music.163.com/' + id['href']             # 获取歌单详情页地址
    response = requests.get(url=url, headers=headers)  
    html = response.text
    soup = BeautifulSoup(html, 'html.parser')
    # 获取歌单标题  
    title = soup.select('h2')[0].get_text().replace(',', '，')
    # 获取封面图片
    img = soup.select('img')[0]['data-src']
    res = requests.get(img)
    image = Image.open(BytesIO(res.content))
    try:
        image.save('week14/cover/'+ title + '.jpg')
    except:
        pass
    # 获取创建者id
    idd = soup.select('.s-fc7')[0]['href'].split('=')[-1]
    # 获取创建者昵称
    nickname = soup.select('.s-fc7')[0].get_text()
    # 获取歌单介绍  
    if soup.select('#album-desc-more'):
        text = soup.select('#album-desc-more')[0].get_text().replace('\n', '').replace(',', '，')  
    else:
        text = '无'   
    # 歌单内歌曲数  
    songs = soup.select('#playlist-track-count')[0].get_text()
    # 播放量  
    plays = soup.select('.s-fc6')[0].get_text()
    # 添加进播放列表次数
    adds = soup.find('a','u-btni u-btni-fav')['data-count']
    # 分享次数
    shares = soup.find('a','u-btni u-btni-share')['data-count']
    # 歌单评论数
    comments = soup.select('#cnt_comment_count')[0].get_text().replace('评论', '0')
    #print(title,idd,nickname,text,songs,plays,adds,shares,comments)
    # 将详情页信息写入CSV文件中
    #with open('week14/music_message.csv', 'a+', encoding='utf-8') as f:
        #f.write(title + ',' + idd + ',' + nickname + ',' + text + ',' + songs + ',' + plays + ',' + adds + ',' + shares + ',' + comments + '\n')
```

### 协程实现：



### 代码：



### 结果展示：

- 运行时间：

  ![image-20221212210157210](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221212210157210.png)

  1311个歌单总耗时 232秒

- 歌单信息：

  

- 封面图片：

  

### Ref：

- 异步爬虫：https://blog.csdn.net/weixin_42277380/article/details/100096906
