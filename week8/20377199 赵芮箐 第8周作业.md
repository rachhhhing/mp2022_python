# 20377199 赵芮箐 第8周作业

![image-20221022003804785](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221022003804785.png)

### 任务一：用函数实现【检查路径装饰器】

```python
import os
from functools import wraps

# 用函数实现文件路径检查装饰器
def path_examine(path):
    def decorator(func):
        @ wraps(func)
        def wrapper(*args, **kwargs):
            if os.path.exists(path) == False:       # 检查路径是否存在
                print('The path does not exist! We creat for you.')
                os.mkdir(path)                      # 创建对应文件夹
            return func(*args,**kwargs)
        return wrapper
    return decorator

# 测试
path = 'test'
@ path_examine(path)

def test(path):
    print(os.path.exists(path))		# 检查路径是否存在输出布尔值
test(path)
```

- 无装饰器效果:

  ![image-20221027163917029](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221027163917029.png)

- 有装饰器效果：

  ![image-20221027164021709](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221027164021709.png)

  > 给出了提示，并且建立了相应的文件夹

### 任务二：用类实现【声音提醒函数结束装饰器】

```python
from functools import wraps
from playsound import playsound

# 用类实现声音提醒函数结束装饰器
class End_Music:
    def __init__(self):
        self.music_path_int = 'D:/code/mp2022/week8/music/int.mp3'
        self.music_path_list = 'D:/code/mp2022/week8/music/list.mp3'
        self.music_path_tuple = 'D:/code/mp2022/week8/music/tuple.mp3'
    
    def __call__(self, func):
        @ wraps(func)
        def wrapper(*args, **kwargs):
            ans_list = func(*args, **kwargs)
            for ans in ans_list:
                if isinstance(ans, int):
                    playsound(self.music_path_int)
                elif isinstance(ans, list):
                    playsound(self.music_path_list)
                elif isinstance(ans, tuple):
                    playsound(self.music_path_tuple)
            return func(*args, **kwargs)
        return wrapper

# 测试
@ End_Music()
def test():
    return 1, [1,2], (1,2)
test()
```

- 装饰器效果：

  > 突然一时间不知道该怎么展示结果哈哈哈，就是按类型听到音乐了！

### 任务三：用类或函数实现【保存输出装饰器】

```python
import sys
from functools import wraps

# 用函数实现保存输出装饰器
def save_print(save_path):
    def decorator(func):
        @ wraps(func)
        def wrapper(*args, **kwargs):
            sys.stdout = open(save_path, 'w')
            return func(*args, **kwargs)
        return wrapper
    return decorator

# 测试
@ save_print('week8/save_print.txt')
def test():
    print('1')
    print('2')
    print('3')
test()
```

- 装饰器效果：

  ![image-20221031105307034](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221031105307034.png)

  > 将运行过程中的输出全部存入特定文件

### 任务四：用类模拟耗时耗内存的操作，并体验相关装饰器功能

```python
import time
import random
import pysnooper
from tqdm import tqdm
from memory_profiler import profile
from line_profiler import LineProfiler

# 用类模拟耗时耗内存的操作
# 这里用生成一个大字典（结构为"ID:成绩"）模拟耗内存操作，用遍历字典查询考某成绩的学生模拟耗时操作
class Grade:
    def __init__(self):
        self.dic = {}

    @ profile                                   # memory profile
    @ pysnooper.snoop('week8/dic.log')          # pysnooper
    def input_grade(self):
        """
        录入成绩的方法，即生成大字典，模拟耗内存操作
        """
        for i in range(10 ** 2):
            self.dic[i] = random.randint(0,100)
    
    def search(self, grade):
        """
        查询成绩的方法，即遍历大字典，模拟耗时操作
        """
        stu = []
        for key in tqdm(self.dic):              # tqdm
            time.sleep(0.000001)
            if self.dic[key] == grade:
                stu.append(key)
        return stu

# 测试
g = Grade()
g.input_grade()

lp = LineProfiler()                             # line profile
lp.enable_by_count()
lp_wrapper = lp(g.search)
stu = g.search(90)
lp.print_stats()
```

- 装饰器效果：

  ![image-20221031135802432](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221031135802432.png)

  > memory_profiler装饰器：显示执行该行解释器的内存使用情况以及当前行相对于上一行的内存差
  >
  > line_profiler装饰器：显示每一行的运行次数、时间及占整个程序的比重
  >
  > tqdm装饰器：显示运行的进度条

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221031142457052.png" alt="image-20221031142457052" style="zoom:67%;" />

  > pysnooper装饰器：自动识别到语句和变量，将其值print出来或其输出到log文件中

### 代码：

https://github.com/rachhhhing/mp2022_python/blob/master/week8/week8.py

### Ref:

- os模块：https://zhuanlan.zhihu.com/p/150835193
- 声音文件处理：https://blog.csdn.net/via_2020/article/details/108270536
- line_profiler：https://www.cnblogs.com/dechinphy/p/line-profiler.html
- memory_profiler：https://zhuanlan.zhihu.com/p/121003986
- tqdm：https://zhuanlan.zhihu.com/p/163613814
- pysnooper：https://zhuanlan.zhihu.com/p/408470180