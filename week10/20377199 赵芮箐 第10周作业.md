# 20377199 赵芮箐 第10周作业

![image-20221104181407926](C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221104181407926.png)

### 任务一：设计抽象类Plotter

> 至少包含抽象方法`plot(data, *args, **kwargs)`方法，以期通过不同子类的具体实现来支持多类型数据的绘制，至少包括数值型数据，文本，图片等。

```python
class Plotter(abc.ABC):
    @abc.abstractmethod
    def plot(self,*arg,**kwargs):
        pass
```

### 任务二：实现类PointPlotter

> 实现数据点型数据的绘制，即输入数据为[(x,y)...]型，每个元素为一个Point类的实例

```python
class PointPlotter(Plotter):
    def __init__(self, point):
        self._point = point

    def plot(self):
        for x,y in self._point:
            plt.scatter(x,y)
        plt.show()
```

### 任务三：实现类ArrayPlotter

> 实现多维数组型数据的绘制，即输入数据可能是[[x1,x2...],[y1,y2...]]或者[[x1,x2...],[y1,y2...],[z1,z2...]]

```python
class ArrayPlotter(Plotter):
    def __init__(self, array):
        self._array = array

    def plot(self):
        if len(self._array) == 2:
            plt.scatter(self._array[0],self._array[1])
            plt.show()
        elif len(self._array) == 3:
            ax = plt.subplot(projection = '3d')
            ax.scatter(self._array[0],self._array[1],self._array[2])
            plt.show()
        else:
            print(f"不支持{len(self._array)}数组绘制")
```

### 任务四： 实现类TextPlotter

> 实现文本型数据的绘制，即输入数据为一段或多段文本，应进行切词，关键词选择（根据频率或tf-idf)，继而生成词云。

```python
class TextPlotter(Plotter):
    def __init__(self, text):
        self._text = text

    def plot(self):
        wordlist = []
        for sen in self._text:
            seg_list = jieba.cut(sen, cut_all=False)
            wordlist.extend(seg_list)
        txt = ' '.join(wordlist)						# generate需要string
        
        img = Image.open("week10/爱心.png")
        img_mask = np.array(img)
        image_colors = ImageColorGenerator(img_mask)

        wc = WordCloud(font_path="simhei.ttf", 
                    mask=img_mask, 
                    background_color="white", 
                    max_words=300, 
                    max_font_size=150)
        wc.generate(txt)                                # 会自动根据词频形成词云图

        plt.imshow(wc.recolor(color_func=image_colors), interpolation='bilinear')
        plt.axis('off')
        plt.show()
```

### 任务五：实现类ImagePlotter

> 实现图片型数据的绘制，即输入数据为图片的路径或者图片内容（可以是多张图片），呈现图片并按某种布局组织（如2x2等)。

```python
class ImagePlotter(Plotter):
    def __init__(self, image):
        self._image = []
        for each in image:
            if isinstance(each, str):               # 判断是否是路径
                img = Image.open(each)
                self._image.append(img)
            else:
                self._image.append(each)

    def plot(self, row=2, col=2):
        for num in range(0,len(self._image), row*col):
            for i in range(row*col):
                if num + i < len(self._image):
                    img = self._image[num+i]
                    plt.subplot(row, col, i+1)
                    plt.imshow(img)
            plt.show()
```

### 任务六：实现类GifPlotter

> 支持一组图片序列的可视化（通过文件路径或图片内容输入），但输出是gif格式的动态图。

```python
class GifPlotter(Plotter):
    def __init__(self, image):
        self._image = []
        for each in image:
            if isinstance(each, str):               # 判断是否是路径
                img = imageio.imread(each)
                self._image.append(img)
            else:
                self._image.append(each)

    def plot(self, save_path = './GifPlotter.gif', duration=0.5):
        imageio.mimsave(save_path, self._image, 'GIF', duration=duration)
```

### 任务七：实现类KeyFeaturePlotter（附加）

> 在3中，如果多维数组超过3维，可否支持pca等降维并绘制（了解pca或者TSNE）

```python
class KeyFeaturePlotter(Plotter):
    def __init__(self, array):
        self._array = array

    def plot(self):
        if len(self._array) <= 3:
            print(f"不支持{len(self._array)}数组绘制")
        else:
            pca = PCA(n_components=2)               # 降到2维
            pca.fit(self._array)
            array = pca.transform(self._array)      # 降维后结果
            for point in array:
                plt.scatter(point[0], point[1])
            plt.show()
```

### 任务八：实现类MusicPlotter（附加）

> 如果输入是一段音频（比如mp3文件），如何进行绘制（了解librosa里的display模块）

```python
class MusicPlotter(Plotter):
    def __init__(self, music):
        self._music = music

    def plot(self):
        x, sr = librosa.load(self._music)
        librosa.display.waveshow(x, sr=sr)
        plt.show()
```

### 任务九：实现类VideoPlotter（附加）

> 在6中，如果输入是一段落视频的话，能否通过帧采样，将视频绘制为gif并输出为微信表情包（了解cv2)

```python
class VideoPlotter(Plotter):
    def __init__(self, video):
        self._video = video

    def plot(self, save_path='./VideoPlotter.gif', duration=0.05):
        cap = cv2.VideoCapture(self._video)
        gif = []
        while cap.isOpened():
            ret, frame = cap.read()
            if ret == False:
                break
            frame = frame[..., ::-1]                # BGR转成RGB
            gif.append(frame)
        cap.release()
        cv2.destroyAllWindows()
        imageio.mimsave(save_path, gif, 'GIF', duration=duration)
```

### 结果展示：

- 点型数据绘制

<img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106112112462.png" alt="image-20221106112112462" style="zoom:67%;" />

- 数组型数据绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106114016057.png" alt="image-20221106114016057" style="zoom:67%;" />

- 文本型数据绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106161418955.png" alt="image-20221106161418955" style="zoom:67%;" />

  > 文本为朱自清的《春》

- 图片型数据绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106165247396.png" alt="image-20221106165247396" style="zoom:67%;" />

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106165307331.png" alt="image-20221106165307331" style="zoom:67%;" />

  > 还是上次filter作业的图嘿嘿

- 图片序列的可视化

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221106181743542.png" alt="image-20221106181743542" style="zoom:67%;" />

- 超过三维数组的绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221113143032343.png" alt="image-20221113143032343" style="zoom:67%;" />

  > 用的是著名的**鸢尾花数据**，取了两种花，还挺容易看得出分类的

- 音频数据的绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221113171049772.png" alt="image-20221113171049772" style="zoom:67%;" />

  > 歌曲《Galway Girl》，这首歌的确非常的满。。。

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221113171304814.png" alt="image-20221113171304814" style="zoom:67%;" />

  > 歌曲《MELANCHOLY》，一首很安静的纯音乐

- 视频数据的绘制

  <img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20221113174328888.png" alt="image-20221113174328888" style="zoom:67%;" />

### 代码：

https://github.com/rachhhhing/mp2022_python/blob/master/week10/week10.py

### Ref：

- PCA：https://blog.csdn.net/qq_52300431/article/details/123482513

- librosa：https://blog.csdn.net/qq7835144/article/details/88812119

  https://blog.csdn.net/Joseph__Lagrange/article/details/110878091

- cv2：https://blog.csdn.net/weixin_42487713/article/details/104173914

  https://blog.csdn.net/qq_36780295/article/details/110490685
